<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ICN Suite — Ops Mode</title>
  <style>
    @font-face { font-family: "CameraPlainVariable"; src: url("https://cdn.gpteng.co/mcp-widgets/v1/fonts/CameraPlainVariable.woff2") format("woff2"); font-weight: 100 900; font-style: normal; font-display: swap; }
    :root{--font:"CameraPlainVariable",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;--bg:#f5f6f8;--card:#fff;--border:#e1e4e8;--muted:#6e7681;--shadow:0 10px 30px rgba(0,0,0,.06);}
    body{margin:0;padding:18px;background:var(--bg);font-family:var(--font);color:#121212;}
    .card{max-width:980px;margin:0 auto;background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px;}
    h1{font-size:18px;margin:0 0 8px;}
    p{margin:0 0 12px;color:var(--muted);line-height:1.35;}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
    a{display:inline-block;padding:10px 14px;border-radius:9999px;border:1px solid var(--border);text-decoration:none;color:#121212;background:#fff;}
    a.primary{background:#121212;color:#fff;border-color:#121212;}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px;color:var(--muted);}
    ul{margin:0 0 10px 18px;color:var(--muted);}
  </style>
</head>
<body>

<div id="backupBanner" style="display:none;position:sticky;top:0;z-index:9999;">
  <div style="background:#fff3cd;border:1px solid #ffeeba;color:#856404;border-radius:12px;padding:10px;margin:10px 0;box-shadow:0 6px 20px rgba(0,0,0,.06);">
    <div style="display:flex;gap:10px;align-items:flex-start;flex-wrap:wrap;justify-content:space-between;">
      <div style="min-width:240px;flex:1 1 auto;">
        <div style="font-weight:700;margin-bottom:4px;">Backup reminder</div>
        <div id="backupBannerMsg" style="font-size:13px;line-height:1.35;">
          Your data is stored locally per browser. Export a backup JSON regularly.
        </div>
        <div id="backupBannerMeta" style="font-size:12px;opacity:.85;margin-top:4px;"></div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
        <a href="/backup" style="text-decoration:none;"><button type="button" style="border:1px solid #e1e4e8;background:#fff;border-radius:9999px;padding:10px 14px;cursor:pointer;">Open Backup Center</button></a>
        <button type="button" id="backupBannerDismiss" style="border:1px solid #e1e4e8;background:#fff;border-radius:9999px;padding:10px 14px;cursor:pointer;">Dismiss</button>
      </div>
    </div>
  </div>
</div>

  <div class="card">
    <h1>ICN Suite — Ops Mode (Plain but Functional)</h1>
    <p>Use this when you need the capabilities now: enter ABT/VAX/IP, parse Protex text, apply with dedup, generate reports.</p>

    <div class="row">
      <a class="primary" href="/entry">Manual Entry (ABT/VAX/IP)</a>
      <a href="/protex">Protex Parser (ABT)</a>
      <a href="/import">Collector + Vault</a>
      <a href="/apply">Apply → Tracker (dedup + backup)</a>
      <a href="/reports">Reports</a>
    </div>

    <p class="mono" style="margin-top:12px;">
      Keys: icn_import_queue_v1 (queue), icn_pack_vault_v1 (vault), icn_state_backup_* (backups)
    </p>

    <ul>
      <li>Enter data: /entry (creates packs and queues them)</li>
      <li>Parse Protex ABT text: /protex (creates ABT packs and queues them)</li>
      <li>Apply into the tracker with schema mapping + dedup: /apply</li>
      <li>Generate operational reports: /reports</li>
    </ul>
  </div>

<script>
(function(){
  const LAST_BACKUP_AT_KEY = "icn_last_backup_at_v1";
  const DISMISS_KEY = "icn_backup_banner_dismissed_v1";
  const DISMISS_DAYS = 1;          // show again after 1 day if dismissed
  const REMIND_DAYS = 7;           // show reminder if last backup older than 7 days
  const banner = document.getElementById("backupBanner");
  const msg = document.getElementById("backupBannerMsg");
  const meta = document.getElementById("backupBannerMeta");
  const dismissBtn = document.getElementById("backupBannerDismiss");

  function daysBetween(aIso, bIso){
    try{
      const a = new Date(aIso).getTime();
      const b = new Date(bIso).getTime();
      if(!isFinite(a) || !isFinite(b)) return null;
      return Math.floor(Math.abs(b - a) / (1000*60*60*24));
    }catch(e){ return null; }
  }

  function shouldShow(){
    const now = new Date().toISOString();
    const last = localStorage.getItem(LAST_BACKUP_AT_KEY) || "";
    const dismissedAt = localStorage.getItem(DISMISS_KEY) || "";

    if(dismissedAt){
      const d = daysBetween(dismissedAt, now);
      if(d !== null && d < DISMISS_DAYS) return false;
    }

    if(!last) return true;
    const age = daysBetween(last, now);
    if(age === null) return true;
    return age >= REMIND_DAYS;
  }

  function render(){
    if(!banner) return;
    if(!shouldShow()){
      banner.style.display = "none";
      return;
    }
    const last = localStorage.getItem(LAST_BACKUP_AT_KEY) || "";
    if(!last){
      msg.textContent = "No recent backup found. Data is local per browser, so export a JSON backup now.";
      meta.textContent = "Last backup: NEVER";
    }else{
      const now = new Date().toISOString();
      const age = daysBetween(last, now);
      msg.textContent = "Your data is local per browser/profile. Export a JSON backup so you can restore/sync across browsers/devices.";
      meta.textContent = "Last backup: " + last.replace("T"," ").replace("Z","") + (age !== null ? (" ("+age+"d ago)") : "");
    }
    banner.style.display = "";
  }

  if(dismissBtn){
    dismissBtn.addEventListener("click", () => {
      localStorage.setItem(DISMISS_KEY, new Date().toISOString());
      if(banner) banner.style.display = "none";
    });
  }

  render();
})();
</script>

</body>
</html>
