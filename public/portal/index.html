<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
  <title>ICN Suite — Mission Control</title>
  <style>
    :root{
      --bg:#0b1220;
      --border:rgba(255,255,255,.14);
      --text:#e5e7eb;
      --muted:rgba(229,231,235,.72);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:
        radial-gradient(1200px 600px at 20% 0%, rgba(255,255,255,.10), transparent 55%),
        radial-gradient(900px 500px at 90% 20%, rgba(255,255,255,.08), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px;margin:0 auto;padding:22px 16px 40px}
    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
      padding:14px 16px;border-radius:18px;background:rgba(255,255,255,.06);border:1px solid var(--border);
      backdrop-filter:blur(10px);
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:240px}
    .logo{
      width:36px;height:36px;border-radius:12px;
      background:linear-gradient(135deg,rgba(255,255,255,.28),rgba(255,255,255,.08));
      border:1px solid rgba(255,255,255,.18);
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .title{font-weight:800;letter-spacing:-.02em}
    .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .pills{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 14px;border-radius:999px;border:1px solid var(--border);
      background:rgba(255,255,255,.06);color:var(--text);text-decoration:none;
      font-weight:700;font-size:13px;
    }
    .pill.primary{background:rgba(255,255,255,.92);color:#0b1220;border-color:rgba(255,255,255,.92)}
    .dot{width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.45)}
    .pill.primary .dot{background:rgba(11,18,32,.65)}
    .hero{
      margin-top:14px;padding:18px;border-radius:22px;border:1px solid var(--border);
      background:linear-gradient(135deg,rgba(255,255,255,.10),rgba(255,255,255,.05));
      box-shadow:0 16px 45px rgba(0,0,0,.25);
    }
    h1{margin:0;font-size:22px;letter-spacing:-.02em}
    .hero p{margin:8px 0 0 0;color:var(--muted);font-size:13px;line-height:1.35}
    .meta{margin-top:12px;display:flex;flex-wrap:wrap;gap:10px}
    .chip{
      display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;
      border:1px solid var(--border);background:rgba(255,255,255,.05);
      font-size:12px;color:var(--muted);
    }
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;color:var(--text)}
    .grid{margin-top:14px;display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){
      .grid{grid-template-columns:1.15fr .85fr}
      .cards{grid-template-columns:repeat(3,minmax(0,1fr))}
      .kpis{grid-template-columns:repeat(4,minmax(0,1fr))}
    }
    .cards{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media(min-width:640px){.cards{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{
      border-radius:20px;border:1px solid var(--border);background:rgba(255,255,255,.06);
      padding:14px;box-shadow:0 12px 36px rgba(0,0,0,.22);
    }
    .card h3{margin:0;font-size:13px}
    .card p{margin:6px 0 0 0;font-size:12px;color:var(--muted);line-height:1.35}
    .card a{
      display:inline-flex;align-items:center;gap:8px;margin-top:10px;padding:10px 12px;border-radius:999px;
      border:1px solid var(--border);background:rgba(255,255,255,.06);
      color:var(--text);text-decoration:none;font-weight:800;font-size:12px;
    }
    .kpis{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:12px}
    .kpi{border-radius:18px;border:1px solid var(--border);background:rgba(255,255,255,.05);padding:12px}
    .kpi .lbl{font-size:12px;color:var(--muted)}
    .kpi .val{margin-top:4px;font-size:22px;font-weight:900;letter-spacing:-.02em}
    .panel{border-radius:20px;border:1px solid var(--border);background:rgba(255,255,255,.06);padding:14px}
    .panel h2{margin:0;font-size:13px}
    .panel ul{margin:10px 0 0 0;padding-left:18px;color:var(--muted);font-size:12px;line-height:1.45}
    .footer{margin-top:16px;font-size:12px;color:rgba(229,231,235,.55)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">ICN Suite</div>
          <div class="sub">Mission Control — visual landing page (local-first)</div>
        </div>
      </div>
      <div class="pills">
        <a class="pill primary" href="/?v=portal"><span class="dot"></span>React App</a>
        <a class="pill" href="/ops?v=portal"><span class="dot"></span>Ops Pro</a>
        <a class="pill" href="/import?v=portal"><span class="dot"></span>Collector</a>
        <a class="pill" href="/reports?v=portal"><span class="dot"></span>Reports</a>
        <a class="pill" href="/backup?v=portal"><span class="dot"></span>Backup</a>
      </div>
    </div>

    <div class="hero">
      <h1>Website-mode: live status + big buttons</h1>
      <p>This page proves the project is alive: big buttons + live counts from localStorage.</p>

      <div class="meta">
        <span class="chip">Build <span class="mono">2026-01-21T23:18:46Z</span></span>
        <span class="chip">Persist key <span id="k" class="mono">—</span></span>
        <span class="chip">Queue <span id="q" class="mono">—</span></span>
      </div>

      <div class="kpis">
        <div class="kpi"><div class="lbl">ABT records</div><div class="val" id="abt">—</div></div>
        <div class="kpi"><div class="lbl">IP records</div><div class="val" id="ip">—</div></div>
        <div class="kpi"><div class="lbl">Vax records</div><div class="val" id="vax">—</div></div>
        <div class="kpi"><div class="lbl">Queued packs</div><div class="val" id="q2">—</div></div>
      </div>
    </div>

    <div class="grid">
      <div>
        <div class="cards">
          <div class="card"><h3>Collector</h3><p>Paste / Protex parse / build pack.</p><a href="/import?v=portal">Open →</a></div>
          <div class="card"><h3>Ops Pro</h3><p>Collector + backup lane.</p><a href="/ops?v=portal">Open →</a></div>
          <div class="card"><h3>Reports</h3><p>Operational reporting page.</p><a href="/reports?v=portal">Open →</a></div>
          <div class="card"><h3>Backup</h3><p>Export JSON at end of day.</p><a href="/backup?v=portal">Open →</a></div>
          <div class="card"><h3>Doctor</h3><p>Schema normalization.</p><a href="/doctor?v=portal">Open →</a></div>
          <div class="card"><h3>React App</h3><p>Your Phase 1 UI (Census/Vax/ABT).</p><a href="/?v=portal">Open →</a></div>
        </div>
      </div>

      <div>
        <div class="panel">
          <h2>Quick checks</h2>
          <ul>
            <li>If ABT/IP/Vax counts are non-zero, your local data layer is working.</li>
            <li>Safari loop fix: this page is served from <span class="mono">/portal/</span> (folder index).</li>
            <li>Try Private tab if your phone cache is stubborn.</li>
          </ul>
        </div>
        <div class="footer">Local-first. No cloud database. Back up daily as JSON.</div>
      </div>
    </div>
  </div>

<script>
(function(){
  const QUEUE_KEY="icn_import_queue_v1";
  function safeParse(raw){try{return JSON.parse(raw)}catch(e){return null}}
  function score(state){
    if(!state||typeof state!=="object")return 0;
    let s=0;
    if(state.modules)s+=5;
    if(Array.isArray(state.modules?.abt?.courses))s+=5;
    if(Array.isArray(state.modules?.vaccinations?.records))s+=5;
    if(Array.isArray(state.modules?.ip?.cases))s+=5;
    if(Array.isArray(state.abt)||Array.isArray(state.antibiotics))s+=3;
    if(Array.isArray(state.vaccinations)||Array.isArray(state.vax))s+=3;
    if(Array.isArray(state.ipCases)||Array.isArray(state.ip)||Array.isArray(state.cases))s+=3;
    return s;
  }
  function detectKey(){
    const keys=Object.keys(localStorage); let best=null;
    for(const k of keys){
      const raw=localStorage.getItem(k);
      if(!raw||raw.length<20)continue;
      if(raw[0]!=="{"&&raw[0]!=="[")continue;
      const obj=safeParse(raw);
      if(!obj||typeof obj!=="object")continue;
      const wrapped=!!obj.state;
      const st=wrapped?obj.state:obj;
      const sc=score(st);
      if(sc<=0)continue;
      if(!best||sc>best.score)best={key:k,wrapped,score:sc};
    }
    return best;
  }
  function counts(det){
    if(!det)return{key:"NOT FOUND",abt:0,ip:0,vax:0};
    const raw=localStorage.getItem(det.key)||"";
    const obj=safeParse(raw)||{};
    const st=det.wrapped?(obj.state||{}):obj;
    const abt=st?.modules?.abt?.courses&&Array.isArray(st.modules.abt.courses)?st.modules.abt.courses
      :Array.isArray(st.abt)?st.abt:Array.isArray(st.antibiotics)?st.antibiotics:[];
    const ip=st?.modules?.ip?.cases&&Array.isArray(st.modules.ip.cases)?st.modules.ip.cases
      :Array.isArray(st.ipCases)?st.ipCases:Array.isArray(st.ip)?st.ip:Array.isArray(st.cases)?st.cases:[];
    const vax=st?.modules?.vaccinations?.records&&Array.isArray(st.modules.vaccinations.records)?st.modules.vaccinations.records
      :Array.isArray(st.vaccinations)?st.vaccinations:Array.isArray(st.vax)?st.vax:[];
    return{key:det.key,abt:abt.length,ip:ip.length,vax:vax.length};
  }
  function qcount(){
    try{const q=safeParse(localStorage.getItem(QUEUE_KEY)||"[]");return Array.isArray(q)?q.length:0}catch{return 0}
  }
  const det=detectKey(); const c=counts(det); const q=qcount();
  document.getElementById("k").textContent=c.key;
  document.getElementById("abt").textContent=String(c.abt);
  document.getElementById("ip").textContent=String(c.ip);
  document.getElementById("vax").textContent=String(c.vax);
  document.getElementById("q").textContent=String(q);
  document.getElementById("q2").textContent=String(q);
})();
</script>
</body>
</html>
